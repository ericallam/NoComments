<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
			 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="content-type" content="text/html;charset=UTF-8" />
	<style type="text/css">
	.iCheckbox_container {
		height:27px;
		width:94px;
		position: relative;
		overflow: hidden;
	}
	.iCheckbox_switch {
		height:27px;
		width:94px;
		background-image:url(images/iphone_switch.png); /* your actual slider image */
		background-repeat:none;
		background-position:0px;
	}
	.iCheckbox_checkbox { /* this is kinda moot since it gets hidden, but here to let you know it exists */
	}

	.iCheckbox_two_checkbox { /* this is kinda moot since it gets hidden, but here to let you know it exists */
	}
	/*
	* below are styles to just pretty up the demo page... they have nothing to do with iCheckbox.
	*/

	</style>
	<script src="jquery.js" type="text/javascript"></script>
	<script src="jquery.iCheckbox.js" type="text/javascript"></script>
	<script type="text/javascript">
	  
	  var port_open = true;

  	// init the checkboxes at dom ready
  	$(document).ready(function(){
  	  var port;
  	  
      chrome.tabs.getSelected(null, function(tab){ 
        port = chrome.tabs.connect(tab.id, {name: "comments_channel"});
        
        port.onDisconnect.addListener(function(msg) {
          port_open = false;
        });
      });
      

  	  
  	  if(localStorage['current_route'] == "on"){
  	    $('#checkOne').iCheckbox("on");
  	  }else{
  	    $('#checkOne').iCheckbox();
  	  }
		  
  		$('#checkOne').change(function(e){
  		  if(this.checked){
  		    if(localStorage['current_route'] == "off"){
    		    localStorage['current_route'] = "on"
    		    console.log('checkOne changed to checked');
    		    if (port_open) {port.postMessage({comments: true})}
  		    }

  		  }else{
  		    if(localStorage['current_route'] == 'on'){
    		    localStorage['current_route'] = "off"
    		    console.log('checkOne changed to not checked')
  		      if (port_open) {port.postMessage({comments: false})}
  		    }
  		  }
  		});
  	});
	

	
	</script>
</head>
<body>
  
<input type="checkbox" id="checkOne" />

</body>
</html>